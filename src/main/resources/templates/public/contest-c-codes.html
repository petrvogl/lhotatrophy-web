<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	  lang="cs">
	<head th:replace="public/fragments/HtmlDocument.html :: DocumentHeadAdmin">
		<!--/* PROTOTYPE */-->
		<title>Administrace — 24th Lhota Trophy</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
	</head>
	<body class="docu-theme">
		<!--/* Page header */-->
		<header th:replace="public/fragments/PageHeader.html :: PageHeaderAdmin"> [ Page Header ] </header>
		<!--/* Page navigation */-->
		<nav th:replace="public/fragments/PageNavigation.html :: PageNavigationAdmin"> [ Navigation ] </nav>

		<!--/*
		*	Page Content
		*/-->
		<main class="page-content">

			<h3>C KÓD</h3>

			<!--/*
			*	C-code input
			*/-->
			<form th:if="${service.contest.checkTeamIsInPlay()}"
				  th:action="@{~/denik/submitCode}"
				  th:object="${submitCodeForm}"
				  method="post">
				<input th:field="*{taskType}" type="hidden" name="taskType"/>
				<input th:field="*{taskCode}" type="hidden" name="taskCode"/>
				<input th:field="*{solution}" type="text" name="solution"/>
				<input type="submit" value="Odeslat"/>
			</form>

			<!--/*
			*	C-code listing
			*/-->
			<th:block th:if="${service.contest.cCodesAcquiredCount() gt 0}">
				<h3>Uznané C-kódy</h3>

				<th:block th:each="code : ${service.contest.cCodesAcquired()}">
					<p> [[${code.solution}]] </p>
				</th:block>
			</th:block>
			
			<!--/*
			*	Wrong attempts listing
			*/-->
			<th:block th:with="invalidCodes=${team.contestProgress.getInvalidCodes('C')}">
				<th:block th:if="${invalidCodes.size() gt 0}">
					<h3>Chybné pokusy</h3>

					<th:block th:each="code : ${invalidCodes}">
						<p> Kód <strong>[[${code}]]</strong> je nesprávný. </p>
					</th:block>
				</th:block>
			</th:block>

			<h3>Pojistka</h3>

			<!--/*
			*	Insurance NOT available
			*/-->
			<th:block th:unless="${service.contest.isInsuranceAvailable()}">
				<p> Možnost zakoupení pojistky se odemkne až získáte [[${appConfig.insuranceCCodeLimit}]]. C kód. </p>
			</th:block>

			<th:block th:if="${service.contest.isInsuranceAvailable()}">
				<!--/*
				*	Insurance already obtained
				*/-->
				<th:block th:if="${service.contest.checkHasInsurance()}">
					<p> 
						Gratulujeme, získali jste pojistku proti výhře první ceny.
						Pokud tuto pojistku získají všechny týmy, které úspěšně dorazí do cíle, tak bude pojistka ze hry vyřazena.
					</p>
				</th:block>

				<!--/*
				*	Insurance to buy
				*/-->
				<th:block th:if="${!service.contest.checkHasInsurance() and service.contest.checkTeamIsInPlay()}">
					<form th:action="@{~/denik/buyInsurance}"
						  th:object="${confirmationForm}"
						  method="post"
						  th:data-confirm-message="|Opravdu si přejete koupit pojistku? Bude vást to stát ${appConfig.insurancePrice} km.|">
						<input type="submit" value="Koupit pojistku" />
						(Cena: [[${appConfig.insurancePrice}]] km)
					</form>
				</th:block>
			</th:block>

			<script type="text/javascript">
				/* <![CDATA[ */
				const forms = document.querySelectorAll("form");
				forms.forEach(form => {
					const confirmMessage = form.getAttribute("data-confirm-message");
					if (LT.isNotEmpty(confirmMessage)) {
						form.onsubmit = (event) => {
							const confirmed = window.confirm(confirmMessage);
							if (!confirmed) {
								event.preventDefault();
							}
							return confirmed;
						};
					}
				});
				/* ]]> */
			</script>
		</main>

		<!--/* Page footer */-->
		<footer th:replace="public/fragments/PageFooter.html :: PageFooterAdmin"> [ Copyright ] </footer>
	</body>
</html>
