<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	  lang="cs">
	<head th:replace="public/fragments/HtmlDocument.html :: DocumentHeadAdmin">
		<!--/* PROTOTYPE */-->
		<title>Administrace — 24th Lhota Trophy</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
	</head>
	<body class="docu-theme">
		<!--/* Page header */-->
		<header th:replace="public/fragments/PageHeader.html :: PageHeaderAdmin"> [ Page Header ] </header>
		<!--/* Page navigation */-->
		<nav th:replace="public/fragments/PageNavigation.html :: PageNavigationAdmin"> [ Navigation ] </nav>

		<!--/*
		*	Page Content
		*/-->
		<main class="page-content">

			<h2>Objednávky</h2>
			
			<h3>Pátek</h3>

			<table th:with="FridayOfferEnum=${T(cz.lhotatrophy.persist.entity.FridayOfferEnum)}"
				   class="simple-theme" style="min-width: 420px;">
				<tr>
					<th> Volba </th>
					<th class="center"> Počet </th>
				</tr>
				<tr th:each="offer : ${FridayOfferEnum.values()}"
					th:with="
					offerText=${offer.description ?: '--'},
					offerCount=${fridayOrders.getCount(offer)}
					">
					<td> [[${offerText}]] </td> <td class="center"> [[${offerCount}]] </td>
				</tr>
			</table>
			
			<h3>Sobota</h3>
			
			<table th:with="SaturdayOfferEnum=${T(cz.lhotatrophy.persist.entity.SaturdayOfferEnum)}"
				   class="simple-theme" style="min-width: 420px;">
				<tr>
					<th> Volba </th>
					<th class="center"> Počet </th>
				</tr>
				<tr th:each="offer : ${SaturdayOfferEnum.values()}"
					th:with="
					offerText=${offer.description ?: '--'},
					offerCount=${saturdayOrders.getCount(offer)}
					">
					<td> [[${offerText}]] </td> <td class="center"> [[${offerCount}]] </td>
				</tr>
			</table>
			
			<h3>Trička</h3>
			
			<table th:with="TshirtOfferEnum=${T(cz.lhotatrophy.persist.entity.TshirtOfferEnum)}"
				   class="simple-theme" style="min-width: 420px;">
				<tr>
					<th> Volba </th>
					<th class="center"> Počet </th>
				</tr>
				<tr th:each="offer : ${TshirtOfferEnum.values()}"
					th:with="
					offerText=${offer.description ?: '--'},
					offerCount=${tshirtOrders.getCount(offer)}
					">
					<td> [[${offerText}]] </td> <td class="center"> [[${offerCount}]] </td>
				</tr>
			</table>
			
		</main>

		<script type="text/javascript">
			/* <![CDATA[ */
			
			const paidCheckboxes = document.querySelectorAll("input[type=checkbox][name=paidCheckbox]");
			paidCheckboxes.forEach(checkbox => {
				checkbox.addEventListener("change", even => {
					const target = event.target;
					const paid = target.checked === true;
					const userId = target.value;
					LT.log.debug("checked:" + paid + "  val:" + userId);

					const confirmed = window.confirm("Opravdu mám změnit stav platby?");
					if (!confirmed) {
						target.checked = !paid;
						return;
					}

					let onCompleteFn = function (xhr, textStatus) {
						const data = xhr.responseJSON;
						if (textStatus === "success" && data.success === true) {
							const paidTextElement = document.getElementById("paidText-" + userId);
							if (paid) {
								LT.dom.removeClass(target.parentElement, "highlight");
								paidTextElement.innerText = "ANO";
							} else {
								LT.dom.addClass(target.parentElement, "highlight");
								paidTextElement.innerText = "NE";
							}
						} else {
							target.checked = !paid;
							LT.log.error("Nepodariolo nastavit stav platby [" + userId
									+ "]: status " + xhr.status + " / " + textStatus);
							window.alert("Došlo k chbě při ukládání změny stavu platby.");
						}
					};
					
					let requestParams = {
						url: "/rest/admin/setUserProperties/" + userId,
						data: JSON.stringify({zaplaceno: paid}),
						onComplete: onCompleteFn,
						onError: LT.function.noop,
						onTimeout: LT.function.noop,
					};
					LT.ajax.send(requestParams, "paidCheckbox-" + userId);
				});
			});

			/* ]]> */
		</script>

		<!--/* Page footer */-->
		<footer th:replace="public/fragments/PageFooter.html :: PageFooterAdmin"> [ Copyright ] </footer>
	</body>
</html>
